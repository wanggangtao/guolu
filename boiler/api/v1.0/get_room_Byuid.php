<?php/** * Created by PhpStorm. * User: sxm * Date: 2019/3/4 * Time: 17:32 */try {    $page = isset($_POST['page'])?safeCheck($_POST['page']):1;    $pageSize  = isset($_POST['pageSize'])?safeCheck($_POST['pageSize']):15;    $id = isset($_POST['id'])?safeCheck($_POST['id']):'';    $keyword  = isset($_POST['keyword'])?safeCheck($_POST['keyword'],0):'';    if(empty($uid)) throw new MyException("缺少用户uid参数",411);    if(empty($id)) throw new MyException("缺少id参数",411);    /**判断是否在公司大群里面****/    $attrs = array();    if(!empty($keyword))    {        $attrs["keyword"] = $keyword;    }    chat_room_msg_config::checkFromFirstRoom($uid);    $chat_record_list = Chat_room::getListByUd($uid,$id,$attrs,$page,$pageSize);    $count=0;    foreach ($chat_record_list as $item){        $dataItem = array();        $dataItem["room_id"] = $item["id"];        $dataItem["room_name"] = $item["name"];        $dataItem["room_first"] = $item["first"];        $dataItem["room_principal_uid"] = $item["principal_uid"];        $dataItem["room_principal_uname"] = $item["principal_uname"];        $dataItem["room_project"] = $item["project"];        $dataItem["room_last_msg_id"] = empty($item["last_msg_id"])?"":$item["last_msg_id"];        $dataItem["room_last_msg_uid"] = empty($item["last_msg_uid"])?"":$item["last_msg_uid"];        $dataItem["room_last_msg_uname"] = empty($item["last_msg_uname"])?"":$item["last_msg_uname"];        $dataItem["room_last_msg_content"] = empty($item["last_msg_content"])?"":$item["last_msg_content"];        $dataItem["room_last_msg_addtime"] = getDateStr($item['last_msg_addtime']);        $dataItem["room_new_count"] = $item['new_count'];        //获取该room对应该uid的最新消息数        $count +=$item['new_count'];        $resultArray[] = $dataItem;    }    $data['data'] = $resultArray;    $data['count'] = $count;    echo action_msg_data(API::SUCCESS_MSG, API::SUCCESS, $data);}catch (MyException $e){    $api->ApiError($e->getCode(), $e->getMessage());}